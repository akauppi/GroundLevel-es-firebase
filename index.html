<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--PROD Favicon
    <link rel="icon" type="image/png" href="favicon.png">
    -->

    <!-- tbd. make 'set' work if we generate both 'index.dev.html' and 'index.html' (production)
    -   from the same source.
    -->
    <!--SET DEV $FB   https://www.gstatic.com/firebasejs/7.14.2 -->
    <!--SET PROD $FB  /__/firebase/7.14.2 -->
    <!--SET DEV,PROD $FB_UI https://www.gstatic.com/firebasejs/ui/4.5.0 -->

    <!-- Firebase
    -   - latest versions -> https://firebase.google.com/support/release-notes/js
    -
    - Note: Firebase is loaded in 'index.html' (and not via 'npm') because the '/__/' method allowed us to get
    -     configuration nicely, both in development and when deployed via Firebase Hosting.
    -
    -     ^-- THIS IS NO LONGER THE CASE, using 'vite' instead of firebase serving, for development.
    -
    - Include only the Firebase features that you need.
    -->
    <!--PROD Firebase
    <script defer src="/__/firebase/7.14.2/firebase-app.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-firestore.js"></script>
    -->
    <!--DEV Firebase -->
    <script defer src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.14.5/firebase-analytics.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.14.5/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.14.5/firebase-firestore.js"></script>
    <!-- -->

    <!--
    - Firebase UI
    -   - latest versions -> https://github.com/firebase/firebaseui-web/releases
    -
    - This is only needed in 'SignIn.vue', but there's no injection to 'head' in Vue.js (seems, by design?) so in
    - development it was easiest to have it here. It likely gets cached, and everyone needs to come through the
    - signin at some point, so there's little benefit in injecting it just for that one page.
    -
    - See discussion -> https://stackoverflow.com/questions/41710898/injecting-into-head-in-vue-js
    -->
    <!--DEV,PROD -->
    <script defer src="https://www.gstatic.com/firebasejs/ui/4.5.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.5.0/firebase-ui-auth.css" />
    <!-- -->

    <!--PROD Firebase config
    <script defer src="/__/firebase/init.js"></script>
    -->
    <!--DEV Firebase config -->
    <script type="module">
      import config from "./__.js"
      firebase.initializeApp(config);

      if (config.measurementId) {
        firebase.analytics();
      }
    </script>
    <!-- -->

    <!--
    - Checking that Firebase loaded properly
    -
    - tbd. If this only happens once per load, and 'App' initialization also, we can place the code in 'main.js'.
    -     It's not bad here, though.
    -->
    <script type="module">
      document.addEventListener('DOMContentLoaded', () => {   // Q: does this fire just once, or after inside-SPA navidations?
        try {
          console.log("'index.html' loaded");    // DEBUG

          const app = firebase.app();
          const features = ['auth'].filter(feature => typeof app[feature] === 'function');
          console.log(`Firebase SDK loaded with: ${features.join(', ')}`);

        } catch (e) {
          console.error(e);
          alert('Error loading the Firebase SDK, check the console.');
        }
      });
    </script>

    <!-- REMOVE: fixed in 16.x
    - Vite 11..14 have a bug/feature that check of 'process.env.NODE_ENV' is not handled. It doesn't show in Vite 10.3.
    -->
    <!--PROD env
    <script></script>
    -->
    <!-- DEV env -->
    <script>
      //if (window.process) alert("Unexpected: 'process.env' exists!");
      //window.process = { env: { NODE_ENV: '' } }
    </script>
    <!-- -->

    <!--PROD Application
    <script type="module" src="/dist/bundle.esm.js"></script>
    -->
    <!--DEV Application -->
    <script type="module" src="src/main.js"></script>
    <!-- -->
  </head>

  <body>
    <div id="app"></div>
  </body>
</html>
