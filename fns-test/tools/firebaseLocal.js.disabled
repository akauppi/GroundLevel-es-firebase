/*
* fns-test/tools/firebaseLocal.js
*
* Firebase client to be used against a locally running, emulated service (both Firestore and Functions).
*
* References:
*   - Add Firebase to your JavaScript project (Firebase docs)
*     -> https://firebase.google.com/docs/web/setup#using-module-bundlers
*
*   NOTE: Many of the instructions given by Firebase (as of Jul 2020) are misleading and conflict with reality. It is
*       VERY HARD to get an emulated functions + Firestore system set up. 22-Jul-20
*
*       - [ ] What is the role of the "app", compared to just using 'firebase.functions()' and 'firebase.firestore()'?
*         - [ ] Does this section (Step 5: Access Firebase in your app) [1] imply one should not use '.app'?
*       - [ ] When to use "admin SDK", "@firebase/testing", "firebase-functions"?  Why do their npm names differ?
*       - [ ] What is the right way to import 'firebase' as ES module? One is recommended. Another works. :/
*       - [ ] What is the role of the "project id", when 100% is locally emulated?
*       - [x] Why cannot I see my data, placed into Firestore via '@firebase/testing', in the emulator UI?
*             - A: Emulator shows one project, the one active in '.firebaserc'. Others work and are emulated, but
*                  invisible in the Emulator UI.
*       - [x] Can I use '.initializeApp' in node.js (here), or should I always use '@firebase/testing' and its
*             '.initializeAdminApp' / '.initializeTestApp'? If either, when is one suitable over the other?
*             - A: Can use normal JavaScript client. '@firebase/testing' is only for testing of access rights.
*       - [x] What is the role of 'firebase-admin' and when should that be used?
*             - A: Only on server side. For desktop node.js use (like testing), use the normal JavaScript client.
*                  This is now clearly mentioned in Firebase documents (as info boxes).
*
*         [1]: https://firebase.google.com/docs/web/setup#namespace
*/
//import firebase from "firebase"
//import * as firebase from "firebase/app"   // according to docs

import * as firebase from '@firebase/testing'

import 'firebase/firestore'
import 'firebase/functions'

firebase.initializeTestApp({
  projectId: "fns-test"   // lower case only; use a dynamic one later if seems needed
});

const [FUNCTIONS_URL, FIRESTORE_HOST] = ["http://localhost:5001", "localhost:8080"];

// Initialize Firebase for emulation
//
// As instructed -> https://firebase.google.com/docs/emulator-suite/connect_functions#web
//
// Note: source code states "change this [functions] instance". But it seems that another 'firebase.functions()'
//    later must return the same instance, since this works. #firebase #docs #unsure
//
firebase.functions().useFunctionsEmulator(FUNCTIONS_URL);

firebase.firestore().settings({   // affects all subsequent use (and can be done only once)
  host: FIRESTORE_HOST,
  ssl: false
});

export {
  firebase
}
